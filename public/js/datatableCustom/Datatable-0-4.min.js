function debounce(func,delay){let timeout;return function(...args){clearTimeout(timeout);timeout=setTimeout(()=>func.apply(this,args),delay)}}function newexportaction(e,dt,button,config){let self=this;let oldStart=dt.settings()[0]._iDisplayStart;let maxLength=dt.settings()[0]._iRecordsDisplay;dt.one("preXhr",function(e,s,data){data.start=0;data.length=maxLength;dt.one("preDraw",function(e,settings){if(button[0].className.indexOf("buttons-copy")>=0){$.fn.dataTable.ext.buttons.copyHtml5.action.call(self,e,dt,button,config)}else if(button[0].className.indexOf("buttons-excel")>=0){$.fn.dataTable.ext.buttons.excelHtml5.available(dt,config)?$.fn.dataTable.ext.buttons.excelHtml5.action.call(self,e,dt,button,config):$.fn.dataTable.ext.buttons.excelFlash.action.call(self,e,dt,button,config)}else if(button[0].className.indexOf("buttons-csv")>=0){$.fn.dataTable.ext.buttons.csvHtml5.available(dt,config)?$.fn.dataTable.ext.buttons.csvHtml5.action.call(self,e,dt,button,config):$.fn.dataTable.ext.buttons.csvFlash.action.call(self,e,dt,button,config)}else if(button[0].className.indexOf("buttons-pdf")>=0){$.fn.dataTable.ext.buttons.pdfHtml5.available(dt,config)?$.fn.dataTable.ext.buttons.pdfHtml5.action.call(self,e,dt,button,config):$.fn.dataTable.ext.buttons.pdfFlash.action.call(self,e,dt,button,config)}else if(button[0].className.indexOf("buttons-print")>=0){$.fn.dataTable.ext.buttons.print.action(e,dt,button,config)}dt.one("preXhr",function(e,s,data){settings._iDisplayStart=oldStart;data.start=oldStart});setTimeout(dt.ajax.reload,0);return false})});dt.ajax.reload()}function dtButtons(options,buttons){const buttonConfigMap={copy:{extend:"copy",title:"",text:'<i class="ri ri-file-copy-2-line me-2"></i>Copy'},excel:{extend:"excel",title:"",text:'<i class="ri ri-file-excel-line me-2"></i>Excel',modifier:{page:"all"}},pdf:{extend:"pdf",title:"",text:'<i class="ri ri-file-pdf-2-line me-2"></i>Pdf',modifier:{page:"all"}},csv:{extend:"csv",title:"",text:'<i class="ri ri-file-list-2-line me-2"></i>Csv'},print:{extend:"print",title:"",text:'<i class="ri ri-printer-line me-2"></i>Print'}};const buttonConfigs=buttons.map(button=>buttonConfigMap[button]).filter(Boolean);return buttonConfigs.map(config=>({...config,className:"dropdown-item",exportOptions:{columns:function(idx,data,node){return options.dataColumns[idx].exportable!==false},format:{body:function(inner,index){if(inner.length<=0)return inner;if(config.extend==="excel"&&inner.length>=10&&!isNaN(parseFloat(inner))&&isFinite(inner)){return"\0"+inner}let el=$.parseHTML(inner);let result="";$.each(el,function(index,item){if(item.classList&&item.classList.contains("user-name")){result+=item.lastChild.firstChild.textContent}else{result+=item.innerText||item.textContent}});return result}},modifier:config.modifier},action:newexportaction}))}function formatColumnName(columnName){return columnName.replace(/_/g," ").replace(/\b\w/g,match=>match.toUpperCase())}function createColumnsHtml(columns){return columns.map(column=>`<th>${formatColumnName(column.name)}</th>`).join("")}function createColumns(id,columns,location){const table=document.getElementById(id);let headerOrFooter=table.querySelector(location);if(!headerOrFooter){headerOrFooter=document.createElement(location);headerOrFooter.classList.add("table-light");table.appendChild(headerOrFooter)}headerOrFooter.innerHTML="";const row=document.createElement("tr");row.classList.add("text-start","fw-bold","fs-7","text-uppercase","gs-0");row.innerHTML=createColumnsHtml(columns);headerOrFooter.appendChild(row)}function dataTableCreate(options){let idTable=$(`#${options.tableId}`);let searchPanel=[];let buttonsConfig=Array.isArray(options.buttons)&&options.buttons.length>0?options.buttons:false;const buttonDom=`${buttonsConfig?'<"row pb-3"<"dt-action-buttons d-flex justify-content-center justify-content-md-end px-5 px-md-3"B>">':""}`;const dom=`${buttonDom}<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6 d-flex justify-content-center justify-content-md-end"f>><"row dt-row"<"table-responsive"t>r><"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>`;idTable.DataTable({autoWidth:false,responsive:false,columns:options.dataColumns,fixedHeader:options.fixedHeader??false,scrollX:options.scrollX??false,searching:options.searching||false,processing:true,serverSide:true,paging:options.paging??true,pageLength:options.pageLength??10,lengthMenu:options.lengthMenu??[10,25,50,75,100],retrieve:options.retrieve??false,select:options.select?options.select==="multi"?{style:"multi",selector:"td:not(.exclude-selection)"}:{style:"os",selector:"td:not(.exclude-selection)"}:false,columnDefs:[{targets:0,searchable:false,orderable:false,className:options.select?"":" table_dt_no",checkboxes:options.select?{selectRow:true,selectAllRender:'<input type="checkbox" class="form-check-input select-all">'}:false}],buttons:buttonsConfig&&[{extend:"collection",className:"btn btn-vimeo dropdown-toggle me-2",text:'<i class="ri ri-export-line me-2"></i>Export',buttons:[dtButtons(options,buttonsConfig)]}],language:{url:"https://cdn.datatables.net/plug-ins/2.0.6/i18n/id.json",processing:"Memuat Data..."},dom:dom,ajax:{url:options.dataUrl,type:"GET",data:function(d){if(options.formId){let transformedData=options.formId?$(`#${options.formId}`).serializeArray().reduce((acc,{name,value})=>{if(acc[name]){if(!Array.isArray(acc[name])){acc[name]=[acc[name]]}if(Array.isArray(value)){acc[name]=acc[name].concat(value)}else{acc[name].push(value)}}else{acc[name]=value}return acc},{}):{};return $.extend({},d,transformedData)}},error:function(xhr,error,code){const descriptions={401:"Sesi anda telah habis, silahkan login kembali!",404:"Data tidak ditemukan!",500:"Internal Server Error"};errorAlert(descriptions[xhr.status]||"Ada masalah saat mengambil data dari server, Silahkan muat ulang halaman")}},preDrawCallback:function(settings){if(options.formId){let submitButton=$(`#${options.formId} input[type="submit"], #${options.formId} button[type="submit"]`);let resetButton=$(`#${options.formId} input[type="reset"], #${options.formId} button[type="reset"]`);if(submitButton.length!==0){const buttonHtml=submitButton.hasClass("btn-bayar")?`<span class="spinner-border me-2" role="status" aria-hidden="true">Bayar`:`<span class="spinner-border me-2" role="status" aria-hidden="true"></span>Cari`;submitButton.html(buttonHtml).prop("disabled",true)}if(resetButton.length!==0){resetButton.prop("disabled",true);resetButton.html(`<span class="spinner-border me-2" role="status" aria-hidden="true"></span>Reset`)}}},createdRow:function(row,data,dataIndex){$(row).find("td").each(function(cellIndex){const columnConfig=options.dataColumns[cellIndex];if(columnConfig.excludeFromSelection){$(this).addClass("exclude-selection")}})},drawCallback:function(settings){let labelNo=$(idTable.DataTable().table().header()).find("th").eq(0);labelNo&&labelNo.removeClass("sorting_asc");if(options.formId){let submitButton=$(`#${options.formId} input[type="submit"], #${options.formId} button[type="submit"]`);let resetButton=$(`#${options.formId} input[type="reset"], #${options.formId} button[type="reset"]`);if(submitButton.length!==0){const buttonHtml=submitButton.hasClass("btn-bayar")?`<span class="ri-cash-line me-2"></span>Bayar`:`<span class="ri-search-line me-2"></span>Cari`;submitButton.html(buttonHtml).prop("disabled",false)}if(resetButton.length!==0){resetButton.html(`<span class="ri-reset-left-line me-2"></span>Reset`);resetButton.prop("disabled",false)}}},initComplete:function(data){if(options.fixedHeader){if(window.Helpers.isNavbarFixed()){let navHeight=$("#layout-navbar").outerHeight();new $.fn.dataTable.FixedHeader($(idTable).dataTable()).headerOffset(navHeight)}else{new $.fn.dataTable.FixedHeader($(idTable).dataTable())}if(options.scrollX){let isHeaderRestored=false;$(window).on("scroll",function(){let fixedHeaderElement=$(".fixedHeader-floating");let tableHeaderOffset=$(`#${options.tableId} thead`).offset().top;let scrollPosition=$(window).scrollTop();if(scrollPosition<=tableHeaderOffset){if(!fixedHeaderElement.is(":visible")&&!isHeaderRestored){setTimeout(function(){idTable.DataTable().columns.adjust()},250);isHeaderRestored=true}}else{if(isHeaderRestored){isHeaderRestored=false}}})}}setTimeout(function(){let labelNo=$(idTable.DataTable().table().header()).find("th").eq(0);labelNo&&labelNo.removeClass("sorting_asc");searchPanel[options.tableId]=$(`#${options.tableId}_filter input`);if(searchPanel[options.tableId]){searchPanel[options.tableId].unbind();searchPanel[options.tableId].bind().on("keyup",debounce(function(){idTable.DataTable().search(this.value).draw()},500))}},0)},error:function(xhr,error,code){errorAlert("Data tidak dapat dimuat")}})}function dataReload(id=null){id&&$(`#${id}`).DataTable().ajax.reload()}function dataReFilter(id=null,formId=null){id&&$(`#${id}`).DataTable().draw()}function getDT(options){if(options.columnUrl&&options.dataColumns){$.ajax({url:options.columnUrl,success:function(data){$.each(data,function(index,column){let renderFunc="";if(column.columnType||column.columntype){let columType=column.columnType||column.columntype;switch(columType.toLowerCase()){case"row":case"number":case"no":renderFunc=function(data,type,row,meta){return meta.row+meta.settings._iDisplayStart+1};break;case"suffix":renderFunc=function(data,type,row){if(type==="display"||type==="filter"){return data+" "+column.suffix}return data};break;case"prefix":renderFunc=function(data,type,row){if(type==="display"||type==="filter"){return column.prefix+" "+data}return data};break;case"currency":renderFunc=function(data,type,row){if(data===null||data===0){return"Rp. 0"}return $.fn.dataTable.render.number(".",",",0,"Rp. ").display(data)};break;case"date":case"dateformat":renderFunc=function(data,type,row){if(type==="display"||type==="filter"){let date=new Date(data);let options={weekday:"long",day:"numeric",month:"long",year:"numeric"};return date.toLocaleDateString("id-ID",options)}return data};break;case"timestamp":renderFunc=function(data,type,row){if(type==="display"||type==="filter"){let date=new Date(data);let options={weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric"};return date.toLocaleDateString("id-ID",options)}return data};break;case"button":renderFunc=function(data,type,row){if(!data||!(type==="display"||type==="filter")){return""}const{buttonClass="btn",buttonIcon,buttonIconSVG,buttonText,noCaption,button,buttonLink}=column;const iconStyle=buttonIcon?`<i class="${buttonIcon}"></i>`:buttonIconSVG||"";const title=buttonText||"";const buttonTextContent=noCaption?"":buttonText;const rowDataJson=JSON.stringify(row).replace(/'/g,"&#39;").replace(/"/g,"&quot;");const createButton=(attributes,content)=>`<button type="button" class="${buttonClass}" title="${title}" ${attributes}>${content}</button>`;switch(button){case"modal":return createButton(`data-bs-toggle="modal" data-bs-target="${buttonLink}" data-val='${rowDataJson}'`,`${iconStyle}${buttonTextContent}`);case"link":const link=buttonLink?buttonLink.replace(":id",row.item_id):"#";return`<a class="${buttonClass}" href="${link}" title="${title}">${iconStyle}${buttonTextContent}</a>`;case"action":return createButton(`data-val='${rowDataJson}'`,`${iconStyle}${buttonTextContent}`);default:return""}};break;case"boolean":renderFunc=function(data,type,row){let trueVal=column.trueVal??"benar";let falseVal=column.falseVal??"Salah";if(column.booleanCheck){trueVal='<i class="ri-check-line"></i>';falseVal='<i class="ri-close-line"></i>'}if(data==="1"||data===1||data===true){return`<span class="badge px-2 rounded-pill bg-label-success">${trueVal}</span>`}else{return`<span class="badge px-2 rounded-pill bg-label-danger">${falseVal}</span>`}};break;case"importstatus":renderFunc=function(data,type,row){let saveVal=column.saveVal??"Dapat Disimpan";let updateVal=column.updateVal??"Update";let falseVal=column.falseVal??"Tidak Dapat Disimpan";if(data==="1"||data===1||data===true){return`<span class="badge px-2 rounded-pill bg-label-success">${saveVal}</span>`}else if(data==="2"||data===2){return`<span class="badge px-2 rounded-pill bg-label-warning">${updateVal}</span>`}else if(data==="0"||data===0||data===false){return`<span class="badge px-2 rounded-pill bg-label-danger">${falseVal}</span>`}};break;case"checkbox":renderFunc=function(data,type,row){let name=column.selectName?column.selectName:"checkbox";return`<input type="checkbox" class="dt-checkboxes form-check-input" name="${column.selectName?column.selectName:"checkbox"}[]" value="${data}">`};break;case"input":renderFunc=function(data,type,row){let attributes=[`type="${column.inputType??"text"}"`,`placeholder="${column.inputPlaceholder??$column.name}"`,`name="${column.inputName??`input[${column.name}]`}"`,`class="${column.inputClass??"form-control"}"`];const nameLength=column.inputPlaceholder??$column.name;if(nameLength.length>0){attributes.push(`style="width: 218.938px;"`)}if(column.inputReadonly===true){attributes.push(`readonly`)}if(column.inputDisabled===true){attributes.push(`disabled`)}if(Number.isInteger(column.inputMin)){attributes.push(`min="${column.inputMin}"`)}if(Number.isInteger(column.inputMax)){attributes.push(`max="${column.inputMax}"`)}return`<input ${attributes.join(" ")}>`};break;case"custom_code_tagihan":renderFunc=function(data,type,row){const descriptions={114e4:"Manual Cash",1140001:"Manual BMI",1140002:"Manual SALDO",1140003:"Transfer Bank Lain",1140004:"INFAQ",1200001:"Loket Manual - Beasiswa",1200002:"Loket Manual - Potongan",1:"Transfer Online",4:"Transfer Online",null:"","":""};return descriptions[data]||data};break}}else{renderFunc=function(data,type,row){if(!data){return""}return data}}options.dataColumns.push({data:column.data,name:column.name,searchable:column.searchable??false,orderable:column.orderable??false,render:renderFunc??false,className:column.className??false,search:false,exportable:column.exportable??false,visible:column.visible??true,excludeFromSelection:column.excludeFromSelection??false})});const locations=["thead","tfoot"];locations.forEach(location=>{if(options[location]){createColumns(options.tableId,options.dataColumns,location)}});dataTableCreate(options)}})}else{warningAlert("Data tidak dapat dimuat, silahkan muat ulang halaman")}}function mergeTableRows(tableSelector,columnIndex){const table=$(tableSelector);let prevCell=null;let rowspan=1;table.find(`tbody tr`).each(function(){const currentCell=$(this).find(`td:eq(${columnIndex})`);if(prevCell&&currentCell.text()===prevCell.text()){currentCell.hide();prevCell.attr("rowspan",++rowspan)}else{prevCell=currentCell;rowspan=1}})}